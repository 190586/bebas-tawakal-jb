var Customer={initialize:function(){var e=this;Login.auth(function(){$(".contentpanel").load("admin/customer-content-panel",function(){$(".sub-menu-customer").addClass("active"),$(".pageheader-h2-icon").attr("class","pageheader-h2-icon"),$(".pageheader-h2-icon").addClass("fa fa-user-circle"),$(".pageheader-h2-text").html(" Customer"),$(".pageheader-module").html("Customer"),$("#formvalidate").validate({submitHandler:function(a){e.saveOrUpdate(a)}}),$("#btn-cancel").on("click",function(e){e.preventDefault(),$("#customerModalForm").modal("hide")}),e.load()})})},load:function(){$("#datatable1").length&&($("#datatable1").dataTable().fnDestroy(),$("#datatable1").show(),$("#datatable1").dataTable({sAjaxSource:"api/customer",sAjaxDataProp:"_embedded.customer",aoColumns:[{mData:null,sWidth:"5%"},{mData:"name"},{mData:"email"},{mData:"phone"},{mData:null,mRender:function(e,a,t){var o=t._links.self.href.split("/"),n=o[o.length-1],i='<a onclick="Customer.detail('+n+')">Edit</a>';return i+='&nbsp;|&nbsp;<a href="#" onclick="if(confirm(\'Are you sure?\')) {Customer.delete('+n+');}">Delete</a>'},bSortable:!1}],bServerSide:!0,fnServerData:this.serverDataProcessor,fnRowCallback:function(e,a,t,o){var n=a.pageSize,i=a.pageNum*n+(t+1);return $("td:eq(0)",e).html(i),a.prime&&$(e).css({"background-color":"#001122"}),e}}))},serverDataProcessor:function(e,a,t){for(var o={},n=0;n<a.length;n++)o[a[n].name]=a[n].value;var i=o.iDisplayLength,s=o.iDisplayStart,r=0==s?0:s/i,c=o.iSortCol_0,l=o.sSortDir_0,u=null!=o["mDataProp_"+c]?o["mDataProp_"+c]:"id",d=new Array;d.push({name:"size",value:i}),d.push({name:"page",value:r}),d.push({name:"sort",value:u+","+l});var m=e;""!=o.sSearch&&(m="api/customer/search/all",d.push({name:"q",value:o.sSearch}));var p=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:m,data:d,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+p)},success:function(e){e.iTotalRecords=e.page.size,e.iTotalDisplayRecords=e.page.totalElements,$.map(e._embedded.customer,function(e,a){e.pageNum=r,e.pageSize=i}),t(e)},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load customer")}})},saveOrUpdate:function(e){var a=this,t={};$(e).serializeArray().map(function(e){t[e.name]=e.value});var o=t.id,n=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");t=JSON.stringify(t),$.ajax({dataType:"json",contentType:"application/json",type:"PUT",url:"api/customer/"+o,data:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+n)},success:function(e){$("#customerModalForm").modal("hide"),Notification.show("success","Customer saved successfully",function(){a.load(),a.loadNotification()})},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to save customer")}})},detail:function(e){var a="api/customer/"+e,t=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:a,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+t)},success:function(e){var a=e._links.self.href.split("/"),t=a[a.length-1];$.isNumeric(t)&&$("#id").val(t),$("#name").val(e.name),$("#email").val(e.email),$("#phone").val(e.phone),$("#approval").attr("checked",e.approval),$("#customerModalForm").modal("show")},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load customer")}})},delete:function(e){var a=this,t="api/customer/"+e,o=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",contentType:"application/json",type:"DELETE",url:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+o)},success:function(e){Notification.show("success","customer deleted successfully"),a.load()},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to delete customer")}})},loadNotification:function(){var e=new Array;e.push({name:"q",value:!1});var a=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:"api/customer/search/approval",data:e,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+a)},success:function(e){var a=e.page.totalElements,t="";$(".header-notification-title").html("You Have "+a+" New Customer"),a>0?($(".header-notification-badge").html(a),$.map(e._embedded.customer,function(e,a){t+='<li class="new"><a onclick="Login.loadModule(\'customer\');"><span class="thumb"><img src="public/images?path='+e.avatarPath+'" alt="" /></span><span class="desc"><span class="name">'+e.name+" ("+e.age+')<span class="badge badge-success">new</span></span><span class="msg">'+e.occupation+"</span></span></a></li>"}),t+='<li class="new"><a onclick="Login.loadModule(\'customer\');">See All New Customers</a></li>',$(".header-notification-list").html(t)):$(".header-notification").hide()},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load notification")}})},getUrlParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))},readImage:function(e,a){if(e.length){var t=e[0],o=new FileReader;o.onload=function(){data=o.result,a(data)},o.readAsDataURL(t)}else a()}};