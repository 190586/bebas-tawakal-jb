var Login={initialize:function(e){var o,a,t,r=this;e?($("#login-warning").hide(),$("#loginform").validate({submitHandler:function(e){r.login()}})):(r.checkLS()?(localStorage.getItem("u"),o=localStorage.getItem("f"),a=localStorage.getItem("ro"),t=localStorage.getItem("ava")):($.cookie("u"),o=$.cookie("f"),a=$.cookie("ro"),t=$.cookie("ava")),$(".my-role").html(a),$(".my-fullname").html(o),$(".my-avatar-path").attr("src","public/images?path="+t),$(".sign-out-button").on("click",function(e){e.preventDefault(),r.logout()}),Partner.loadNotification(),this.loadModule())},checkLS:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}},logout:function(){this.checkLS()?(localStorage.removeItem("t"),localStorage.removeItem("r"),localStorage.removeItem("f"),localStorage.removeItem("ro"),localStorage.removeItem("u"),localStorage.removeItem("ava")):($.removeCookie("t"),$.removeCookie("r"),$.removeCookie("f"),$.removeCookie("ro"),$.removeCookie("u"),$.removeCookie("ava")),window.location="login"},auth:function(e){if(this.checkLS()){if(localStorage.getItem("t")&&localStorage.getItem("r"))return void e()}else if($.cookie("t")&&$.cookie("r"))return void e();window.location="login"},login:function(){var e=this;$("#login-warning").hide(),$("#login-button").attr("disabled",!0);var o="oauth/token?grant_type=password&username="+$("#username").val()+"&password="+$("#password").val();$.ajax({dataType:"json",type:"GET",url:o,beforeSend:function(e){e.setRequestHeader("Authorization","Basic dGFsZW50czpzZWNyZXQ=")},success:function(o){null!=o.access_token&&(e.checkLS()?(localStorage.setItem("t",o.access_token),localStorage.setItem("r",o.refresh_token)):($.cookie("t",o.access_token),$.cookie("r",o.refresh_token)),$.ajax({dataType:"json",type:"GET",url:"api/usercustom/view",beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+o.access_token)},success:function(o){"00"==o.ERROR_CODE?(e.checkLS()?(localStorage.setItem("u",o.RESULTS.username),localStorage.setItem("f",o.RESULTS.fullname),localStorage.setItem("ro",o.RESULTS.role),localStorage.setItem("ava",o.RESULTS.avatarPath)):($.cookie("u",o.RESULTS.username),$.cookie("f",o.RESULTS.fullname),$.cookie("ro",o.RESULTS.role),$.cookie("ava",o.RESULTS.avatarPath)),window.location="admin"):($("#login-warning").show(),$("#login-button").attr("disabled",!1))},error:function(e){$("#login-warning").show(),$("#login-button").attr("disabled",!1)}}))},error:function(e){$("#login-warning").show(),$("#login-button").attr("disabled",!1)}})},loadModule:function(e){switch($("ul.main-menu li").each(function(e){$(this).removeClass("active")}),e){case"customer":Customer.initialize();break;case"partner":Partner.initialize();break;case"menu":Menu.initialize();break;case"myprofile":Profile.initialize();break;case"user":User.initialize();break;default:$(".sub-menu-dashboard").addClass("active"),$(".pageheader-h2-icon").attr("class","pageheader-h2-icon"),$(".pageheader-h2-icon").addClass("fa fa-home"),$(".pageheader-h2-text").html(" Dashboard"),$(".pageheader-module").html("Dashboard"),$(".contentpanel").html("")}}};