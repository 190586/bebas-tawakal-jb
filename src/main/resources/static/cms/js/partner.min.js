var Partner={initialize:function(){var a=this;Login.auth(function(){$(".contentpanel").load("admin/partner-content-panel",function(){$(".sub-menu-partner").addClass("active"),$(".pageheader-h2-icon").attr("class","pageheader-h2-icon"),$(".pageheader-h2-icon").addClass("fa fa-handshake-o"),$(".pageheader-h2-text").html(" Partner"),$(".pageheader-module").html("Partner"),$(".wysihtml5text").wysihtml5({stylesheets:[]}),$("#formvalidate").validate({submitHandler:function(e){a.saveOrUpdate(e)}}),$("#btn-cancel").on("click",function(a){a.preventDefault(),$("#partnerModalForm").modal("hide")}),a.load()})})},load:function(){$("#datatable1").length&&($("#datatable1").dataTable().fnDestroy(),$("#datatable1").show(),$("#datatable1").dataTable({sAjaxSource:"api/partner",sAjaxDataProp:"_embedded.partner",aoColumns:[{mData:null,sWidth:"5%"},{mData:null,mRender:function(a,e,t){return'<div align="center"><img src="public/images?path='+t.avatarPath+'" style="width:90px;height:90px;padding:3px;border:thin solid #dddddd;border-radius:5px;"></div>'}},{mData:null,mRender:function(a,e,t){var n=void 0==t.companyName||null==t.companyName?"-":t.companyName+"<br>";return n+=void 0==t.name||null==t.name?"":t.name+"<br>",n+=void 0==t.phone||null==t.phone?"":t.phone+"<br>",n+=void 0==t.phone2||null==t.phone2?"":t.phone2+"<br>",n+=void 0==t.website||null==t.website?"":t.website+"<br>",n+=void 0==t.email||null==t.email?"":t.email+"<br>"}},{mData:"address"},{mData:"content"},{mData:null,mRender:function(a,e,t){var n=t._links.self.href.split("/"),o=n[n.length-1],r='<a onclick="Partner.detail('+o+')">Edit</a>';return r+='&nbsp;|&nbsp;<a href="#" onclick="if(confirm(\'Are you sure?\')) {Partner.delete('+o+');}">Delete</a>'},bSortable:!1}],bServerSide:!0,fnServerData:this.serverDataProcessor,fnRowCallback:function(a,e,t,n){var o=e.pageSize,r=e.pageNum*o+(t+1);return $("td:eq(0)",a).html(r),e.prime&&$(a).css({"background-color":"#001122"}),a}}),$("#datatable1_wrapper").find("div[id$=_filter]").append(' <label><button class="btn btn-sm btn-primary" onclick="Partner.detail();">Add Partner</button>'))},serverDataProcessor:function(a,e,t){for(var n={},o=0;o<e.length;o++)n[e[o].name]=e[o].value;var r=n.iDisplayLength,i=n.iDisplayStart,l=0==i?0:i/r,s=n.iSortCol_0,d=n.sSortDir_0,c=null!=n["mDataProp_"+s]?n["mDataProp_"+s]:"id",p=new Array;p.push({name:"size",value:r}),p.push({name:"page",value:l}),p.push({name:"sort",value:c+","+d});var u=a;""!=n.sSearch&&(u="api/partner/search/all",p.push({name:"q",value:n.sSearch}));var h=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:u,data:p,beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+h)},success:function(a){a.iTotalRecords=a.page.size,a.iTotalDisplayRecords=a.page.totalElements,$.map(a._embedded.partner,function(a,e){a.pageNum=l,a.pageSize=r}),t(a)},error:function(a){401==a.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load partner")}})},saveOrUpdate:function(a){var e=this,t={};$(a).serializeArray().map(function(a){t[a.name]=a.value});var n=t.id,o=$("#avatar")[0],r=new Array("image/jpg","image/jpeg","image/png");if(o.files.length&&-1===$.inArray(o.files[0].type,r))$('label[for="avatar"]').html("Accepted formats are only jpg, jpeg and png"),$('label[for="avatar"]').css("display","block");else{var i=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");e.readImage(o.files,function(a){void 0!==a&&(t.avatarPath=a.replace(/^data:image\/[a-z]+;base64,/,""),t.avatarPathChanged=!0),t=JSON.stringify(t),$.ajax({dataType:"json",contentType:"application/json",type:"PUT",url:"api/partnercustom/"+n,data:t,beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+i)},success:function(a){a.RESULTS?($("#partnerModalForm").modal("hide"),Notification.show("success","Partner saved successfully",function(){e.load(),e.loadNotification()})):Notification.show("danger","Failed to save partner")},error:function(a){401==a.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to save partner")}})})}},detail:function(a){if(void 0==a)$("#companyName").val(""),$("#email").val(""),$("#phone").val(""),$("#phone2").val(""),$("#website").val(""),$("#address").data("wysihtml5").editor.setValue(""),$("#address").autogrow(),$("#content").data("wysihtml5").editor.setValue(""),$("#content").autogrow(),$(".avatar-preview").css("display","none"),$("#avatar-image").attr("src",""),$("#approval").attr("checked",!1),$("#partnerModalForm").modal("show");else{var e="api/partner/"+a,t=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:e,beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+t)},success:function(a){var e=a._links.self.href.split("/"),t=e[e.length-1];$.isNumeric(t)&&$("#id").val(t),$("#companyName").val(a.companyName),$("#email").val(a.email),$("#phone").val(a.phone),$("#phone2").val(a.phone2),$("#website").val(a.website),$("#address").data("wysihtml5").editor.setValue(a.address),$("#address").autogrow(),$("#content").data("wysihtml5").editor.setValue(a.content),$("#content").autogrow(),null!=a.avatarPath&&""!==a.avatarPath?($("#avatar-image").attr("src","public/images?path="+a.avatarPath),$(".avatar-preview").css("display","block"),$("#avatar-fileupload").attr("class","fileupload fileupload-new"),$(".fileupload-preview").html("")):($(".avatar-preview").css("display","none"),$("#avatar-image").attr("src","")),$("#approval").attr("checked",a.approval),$("#partnerModalForm").modal("show")},error:function(a){401==a.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load partner")}})}},delete:function(a){var e=this,t="api/partnercustom/"+a,n=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",contentType:"application/json",type:"DELETE",url:t,beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+n)},success:function(a){Notification.show("success","Partner deleted successfully"),e.load()},error:function(a){401==a.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to delete partner")}})},loadNotification:function(){var a=new Array;a.push({name:"q",value:!1});var e=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:"api/partner/search/approval",data:a,beforeSend:function(a){a.setRequestHeader("Authorization","Bearer "+e)},success:function(a){var e=a.page.totalElements,t="";$(".header-notification-title").html("You Have "+e+" New Partners"),e>0?($(".header-notification-badge").html(e),$.map(a._embedded.partner,function(a,e){t+='<li class="new"><a onclick="Login.loadModule(\'partner\');"><span class="thumb"><img src="public/images?path='+a.avatarPath+'" alt="" /></span><span class="desc"><span class="name">'+a.name+" ("+a.age+')<span class="badge badge-success">new</span></span><span class="msg">'+a.occupation+"</span></span></a></li>"}),t+='<li class="new"><a onclick="Login.loadModule(\'partner\');">See All New Partners</a></li>',$(".header-notification-list").html(t)):$(".header-notification").hide()},error:function(a){401==a.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load notification")}})},getUrlParameter:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+a+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},readImage:function(a,e){if(a.length){var t=a[0],n=new FileReader;n.onload=function(){data=n.result,e(data)},n.readAsDataURL(t)}else e()}};