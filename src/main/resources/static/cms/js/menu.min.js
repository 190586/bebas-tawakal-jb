var Menu={initialize:function(){var e=this;Login.auth(function(){$(".contentpanel").load("admin/menu-content-panel",function(){$(".sub-menu-menu").addClass("active"),$(".pageheader-h2-icon").attr("class","pageheader-h2-icon"),$(".pageheader-h2-icon").addClass("fa fa-tasks"),$(".pageheader-h2-text").html(" Menu"),$(".pageheader-module").html("Menu"),$(".chosen-select").chosen({width:"100%"}),$("#orders").spinner({min:1,max:150}),$(".wysihtml5text").wysihtml5({stylesheets:[]}),$("#type").change(function(){var t="",a="";switch($(this).val()){case"TOP-MENU":t="title",a="buttonText, description, shortDescription, menu-image-fileupload";break;case"HOME-SLIDER":t="menu-image-fileupload, title",a="buttonText, description, shortDescription";break;case"PARTNER-SECTION":case"STEP-SECTION":t="description, menu-image-fileupload, title",a="buttonText, shortDescription";break;case"PACKAGE-SECTION":t="description, title",a="buttonText, menu-image-fileupload, shortDescription";break;case"DONATION-SECTION":t="description, menu-image-fileupload, title",a="buttonText, shortDescription";break;case"FOOTER-FIRST-SECTION":case"FOOTER-SECOND-SECTION":t="title",a="buttonText, description, menu-image-fileupload, shortDescription";break;case"FOOTER-ACTION-SECTION":t="shortDescription, title",a="buttonText, description, menu-image-fileupload";break;case"FOOTER-IDENTITY-SECTION":t="menu-image-fileupload, shortDescription, title",a="buttonText, description"}e.showAllElements(t),e.hideAllElements(a)}),$("#imageOption").change(function(){$(this).attr("checked")?($("#menu-image").parent().addClass("hidden"),$("#iconPath").parent().removeClass("hidden")):($("#menu-image").parent().removeClass("hidden"),$("#iconPath").parent().addClass("hidden"))}),$("#formvalidate").validate({submitHandler:function(t){e.saveOrUpdate(t)}}),$("#startTime").datepicker({dateFormat:"yy-mm-dd"}),$("#endTime").datepicker({dateFormat:"yy-mm-dd"}),$("#btn-cancel").on("click",function(e){e.preventDefault(),$("#menuModalForm").modal("hide")}),e.load()})})},load:function(){$("#datatable1").length&&($("#datatable1").dataTable().fnDestroy(),$("#datatable1").show(),$("#datatable1").dataTable({sAjaxSource:"api/menu",sAjaxDataProp:"_embedded.menu",aoColumns:[{mData:null,sWidth:"5%"},{mData:"title"},{mData:"type"},{mData:"description"},{mData:"orders"},{mData:null,mRender:function(e,t,a){return a.startTime.substring(0,10).replace(/-/g,"/")+" - "+a.endTime.substring(0,10).replace(/-/g,"/")},bSortable:!1},{mData:null,mRender:function(e,t,a){var i=a._links.self.href.split("/"),n=i[i.length-1],o='<a onclick="Menu.detail('+n+')">Edit</a>';return o+='&nbsp;|&nbsp;<a href="#" onclick="if(confirm(\'Are you sure?\')) {Menu.delete('+n+');}">Delete</a>'},bSortable:!1}],bServerSide:!0,fnServerData:this.serverDataProcessor,fnRowCallback:function(e,t,a,i){var n=t.pageSize,o=t.pageNum*n+(a+1);return $("td:eq(0)",e).html(o),t.active||$(e).css({"background-color":"#ffaabb"}),e}}),$("#datatable1_wrapper").find("div[id$=_filter]").append(' <label><button class="btn btn-sm btn-primary" onclick="Menu.detail();">Add Menu</button>'))},serverDataProcessor:function(e,t,a){for(var i={},n=0;n<t.length;n++)i[t[n].name]=t[n].value;var o=i.iDisplayLength,r=i.iDisplayStart,s=0==r?0:r/o,l=i.iSortCol_0,d=i.sSortDir_0,c=null!=i["mDataProp_"+l]?i["mDataProp_"+l]:"id",u=new Array;u.push({name:"size",value:o}),u.push({name:"page",value:s}),u.push({name:"sort",value:c+","+d});var m=e;""!=i.sSearch&&(m="api/menu/search/all",u.push({name:"q",value:i.sSearch}));var p=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:m,data:u,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+p)},success:function(e){e.iTotalRecords=e.page.size,e.iTotalDisplayRecords=e.page.totalElements,$.map(e._embedded.menu,function(e,t){e.pageNum=s,e.pageSize=o}),a(e)},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load menu")}})},saveOrUpdate:function(e){var t=this,a={};$(e).serializeArray().map(function(e){a[e.name]=e.value});var i=a.id,n=""===i?"POST":"PUT",o=""===i?"api/menucustom":"api/menucustom/"+i,r=$("#image")[0],s=new Array("image/jpg","image/jpeg","image/png");if(r.files.length&&-1===$.inArray(r.files[0].type,s))$('label[for="image"]').html("Accepted formats are only jpg, jpeg and png"),$('label[for="image"]').css("display","block");else{var l=Login.checkLS()?localStorage.getItem("t"):$.cookie("t"),d=function(e){$.ajax({dataType:"json",contentType:"application/json",type:n,url:o,data:e,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+l)},success:function(e){e.RESULTS?($("#menuModalForm").modal("hide"),Notification.show("success","Menu saved successfully",function(){t.load()})):Notification.show("danger","Failed to save menu")},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to save menu")}})};$("#imageOption").attr("checked")?(a.imagePath="",a=JSON.stringify(a),d(a)):this.readImage(r.files,function(e){void 0!==e?(a.imagePath=e.replace(/^data:image\/[a-z]+;base64,/,""),a.imagePathChanged=!0,a.iconPath=""):(a.imagePath=$("#old-image").val(),a.imagePathChanged=!1,delete a.old,image),a=JSON.stringify(a),d(a)})}},detail:function(e){if(void 0==e)$("#header-title-mode").html("Create New"),$("#header-title").html(""),$("#id").val(""),$("#title").val(""),$("#type").val(""),$("#type").trigger("chosen:updated"),$("#shortDescription").data("wysihtml5").editor.setValue(""),$("#shortDescription").autogrow(),$("#description").data("wysihtml5").editor.setValue(""),$("#description").autogrow(),$("#url").val("#"),$("#buttonText").val(""),$("#menu-image").css("display","none"),$("#menu-image").attr("src",""),$("#orders").val("1"),$("#dataHref").val("false"),$("#dataHref").trigger("chosen:updated"),$("#startTime").val(""),$("#endTime").val(""),$("#active").val("true"),$("#active").trigger("chosen:updated"),$("#menuModalForm").modal("show");else{var t="api/menu/"+e,a=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+a)},success:function(e){var t=e._links.self.href.split("/"),a=t[t.length-1];$.isNumeric(a)&&$("#id").val(a),$("#header-title-mode").html("Edit"),$("#header-title").html('"'+e.title+'"'),$("#title").val(e.title),$("#type").val(e.type),$("#type").trigger("chosen:updated"),$("#shortDescription").data("wysihtml5").editor.setValue(e.shortDescription),$("#shortDescription").autogrow(),$("#description").data("wysihtml5").editor.setValue(e.description),$("#description").autogrow(),$("#url").val(e.url),$("#buttonText").val(e.buttonText),null!=e.imagePath&&""!==e.imagePath?($("#menu-image").attr("src","public/images?path="+e.imagePath),$("#menu-image").css("display","block"),$("#menu-image-fileupload").attr("class","fileupload fileupload-new"),$(".fileupload-preview header-image-preview").html("")):($("#menu-image").css("display","none"),$("#menu-image").attr("src","")),$("#orders").val(e.orders),$("#dataHref").val(e.dataHref?"true":"false"),$("#dataHref").trigger("chosen:updated"),$("#startTime").val(e.startTime.substring(0,10)),$("#endTime").val(e.endTime.substring(0,10)),$("#active").val(e.active?"true":"false"),$("#active").trigger("chosen:updated"),$("#menuModalForm").modal("show")},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load menu")}})}},delete:function(e){var t=this,a="api/menu/"+e,i=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",contentType:"application/json",type:"DELETE",url:a,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+i)},success:function(e){Notification.show("success","Menu deleted successfully"),t.load()},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to delete menu")}})},getUrlParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},readImage:function(e,t){if(e.length){var a=e[0],i=new FileReader;i.onload=function(){data=i.result,t(data)},i.readAsDataURL(a)}else t()},showAllElements:function(e){for(var t=e.split(","),a=0;a<t.length;a++)$("#"+t[a].replace(/ /g,"")).parent().parent().show()},hideAllElements:function(e){for(var t=e.split(","),a=0;a<t.length;a++)$("#"+t[a].replace(/ /g,"")).parent().parent().hide()}};