var Menu={initialize:function(){var e=this;Login.auth(function(){$(".contentpanel").load("admin/menu-content-panel",function(){$(".sub-menu-menu").addClass("active"),$(".pageheader-h2-icon").attr("class","pageheader-h2-icon"),$(".pageheader-h2-icon").addClass("fa fa-tasks"),$(".pageheader-h2-text").html(" Menu"),$(".pageheader-module").html("Menu"),$(".chosen-select").chosen({width:"100%"}),$("#orders").spinner({min:1,max:150}),$(".wysihtml5text").wysihtml5({stylesheets:[]}),$("#formvalidate").validate({submitHandler:function(a){e.saveOrUpdate(a)}}),$("#startTime").datepicker({dateFormat:"yy-mm-dd"}),$("#endTime").datepicker({dateFormat:"yy-mm-dd"}),$("#btn-cancel").on("click",function(e){e.preventDefault(),$("#menuModalForm").modal("hide")}),e.load()})})},load:function(){$("#datatable1").length&&($("#datatable1").dataTable().fnDestroy(),$("#datatable1").show(),$("#datatable1").dataTable({sAjaxSource:"api/menu",sAjaxDataProp:"_embedded.menu",aoColumns:[{mData:null,sWidth:"5%"},{mData:"title"},{mData:"type"},{mData:"description"},{mData:"orders"},{mData:null,mRender:function(e,a,t){return t.startTime.substring(0,10).replace(/-/g,"/")+" - "+t.endTime.substring(0,10).replace(/-/g,"/")},bSortable:!1},{mData:null,mRender:function(e,a,t){var i=t._links.self.href.split("/"),n=i[i.length-1],o='<a onclick="Menu.detail('+n+')">Edit</a>';return o+='&nbsp;|&nbsp;<a href="#" onclick="if(confirm(\'Are you sure?\')) {Menu.delete('+n+');}">Delete</a>'},bSortable:!1}],bServerSide:!0,fnServerData:this.serverDataProcessor,fnRowCallback:function(e,a,t,i){var n=a.pageSize,o=a.pageNum*n+(t+1);return $("td:eq(0)",e).html(o),a.active||$(e).css({"background-color":"#ffaabb"}),e}}),$("#datatable1_wrapper").find("div[id$=_filter]").append(' <label><button class="btn btn-sm btn-primary" onclick="Menu.detail();">Add Menu</button>'))},serverDataProcessor:function(e,a,t){for(var i={},n=0;n<a.length;n++)i[a[n].name]=a[n].value;var o=i.iDisplayLength,r=i.iDisplayStart,s=0==r?0:r/o,l=i.iSortCol_0,d=i.sSortDir_0,u=null!=i["mDataProp_"+l]?i["mDataProp_"+l]:"id",c=new Array;c.push({name:"size",value:o}),c.push({name:"page",value:s}),c.push({name:"sort",value:u+","+d});var m=e;""!=i.sSearch&&(m="api/menu/search/all",c.push({name:"q",value:i.sSearch}));var p=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:m,data:c,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+p)},success:function(e){e.iTotalRecords=e.page.size,e.iTotalDisplayRecords=e.page.totalElements,$.map(e._embedded.menu,function(e,a){e.pageNum=s,e.pageSize=o}),t(e)},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load menu")}})},saveOrUpdate:function(e){var a=this,t={};$(e).serializeArray().map(function(e){t[e.name]=e.value});var i=t.id,n=""===i?"POST":"PUT",o=""===i?"api/menucustom":"api/menucustom/"+i,r=$("#image")[0],s=new Array("image/jpg","image/jpeg","image/png");if(r.files.length&&-1===$.inArray(r.files[0].type,s))$('label[for="image"]').html("Accepted formats are only jpg, jpeg and png"),$('label[for="image"]').css("display","block");else{var l=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");this.readImage(r.files,function(e){void 0!==e&&(t.imagePath=e.replace(/^data:image\/[a-z]+;base64,/,""),t.imagePathChanged=!0),t=JSON.stringify(t),$.ajax({dataType:"json",contentType:"application/json",type:n,url:o,data:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+l)},success:function(e){e.RESULTS?($("#menuModalForm").modal("hide"),Notification.show("success","Menu saved successfully",function(){a.load()})):Notification.show("danger","Failed to save menu")},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to save menu")}})})}},detail:function(e){if(void 0==e)$("#header-title-mode").html("Create New"),$("#header-title").html(""),$("#id").val(""),$("#title").val(""),$("#type").val("CAROUSEL"),$("#type").trigger("chosen:updated"),$("#shortDescription").data("wysihtml5").editor.setValue(""),$("#shortDescription").autogrow(),$("#description").data("wysihtml5").editor.setValue(""),$("#description").autogrow(),$("#url").val("#"),$("#buttonText").val(""),$("#menu-image").css("display","none"),$("#menu-image").attr("src",""),$("#orders").val("1"),$("#dataHref").val("false"),$("#startTime").val(""),$("#endTime").val(""),$("#active").val("true"),$("#active").trigger("chosen:updated"),$("#menuModalForm").modal("show");else{var a="api/menu/"+e,t=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",type:"GET",url:a,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+t)},success:function(e){var a=e._links.self.href.split("/"),t=a[a.length-1];$.isNumeric(t)&&$("#id").val(t),$("#header-title-mode").html("Edit"),$("#header-title").html('"'+e.title+'"'),$("#title").val(e.title),$("#type").val(e.type),$("#type").trigger("chosen:updated"),$("#shortDescription").data("wysihtml5").editor.setValue(e.shortDescription),$("#shortDescription").autogrow(),$("#description").data("wysihtml5").editor.setValue(e.description),$("#description").autogrow(),$("#url").val(e.url),$("#buttonText").val(e.buttonText),null!=e.imagePath&&""!==e.imagePath?($("#menu-image").attr("src","public/images?path="+e.imagePath),$("#menu-image").css("display","block"),$("#menu-image-fileupload").attr("class","fileupload fileupload-new"),$(".fileupload-preview header-image-preview").html("")):($("#menu-image").css("display","none"),$("#menu-image").attr("src","")),$("#orders").val(e.orders),$("#dataHref").val(e.dataHref?"true":"false"),$("#dataHref").trigger("chosen:updated"),$("#startTime").val(e.startTime.substring(0,10)),$("#endTime").val(e.endTime.substring(0,10)),$("#active").val(e.active?"true":"false"),$("#active").trigger("chosen:updated"),$("#menuModalForm").modal("show")},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to load menu")}})}},delete:function(e){var a=this,t="api/menu/"+e,i=Login.checkLS()?localStorage.getItem("t"):$.cookie("t");$.ajax({dataType:"json",contentType:"application/json",type:"DELETE",url:t,beforeSend:function(e){e.setRequestHeader("Authorization","Bearer "+i)},success:function(e){Notification.show("success","Menu deleted successfully"),a.load()},error:function(e){401==e.status?Notification.show("danger","Session timed out, please re-login...",function(){Login.logout()}):Notification.show("danger","Failed to delete menu")}})},getUrlParameter:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))},readImage:function(e,a){if(e.length){var t=e[0],i=new FileReader;i.onload=function(){data=i.result,a(data)},i.readAsDataURL(t)}else a()}};